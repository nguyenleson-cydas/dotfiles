#!/usr/bin/env bash

dirs=$(zoxide query -l)

[[ -z "$dirs" ]] && { echo "No zoxide entries"; exit 1; }

selected=$(printf '%s\n' "$dirs" | fzf --tmux center --border=rounded --prompt="Go to: ")

[[ -z "${selected:-}" ]] && exit 0

session_name=$(basename "$selected")

if [[ -z "${TMUX:-}" ]]; then
  tmux new-session -A -s "$session_name" -c "$selected"
else
  if tmux has-session -t "$session_name" 2>/dev/null; then
    tmux switch-client -t "$session_name"
  else
    tmux new-session -d -s "$session_name" -c "$selected"
    tmux switch-client -t "$session_name"
  fi
fi
